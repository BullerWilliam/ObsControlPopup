<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Live Chat Overlay</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

#container {
    width: 800px;
    height: 600px;
    display: none;
    overflow-y: auto;
}

.message {
    color: white;
    font-size: 18px;
    margin-bottom: 8px;
}

.name {
    font-weight: bold;
    color: #00ffcc;
}
</style>
</head>
<body>

<div id="container"></div>

<script>
let apiKey = "YOUR_API_KEY_HERE"
let container = document.getElementById("container")
let chatId = null
let nextPage = ""
let interval = null

function extractChannel(input) {
    input = input.trim()
    if (input.startsWith("http")) {
        let parts = input.split("/")
        return parts[parts.length - 1]
    }
    return input
}

async function getChannelId(input) {
    input = extractChannel(input)
    if (input.startsWith("UC")) return input
    if (input.startsWith("@")) {
        let r = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=id&forHandle=${input.slice(1)}&key=${apiKey}`)
        let j = await r.json()
        if (j.items && j.items.length) return j.items[0].id
    }
    let r = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${input}&key=${apiKey}`)
    let j = await r.json()
    if (j.items && j.items.length) return j.items[0].snippet.channelId
    return null
}

async function getLiveVideo(channelId) {
    let r = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${apiKey}`)
    let j = await r.json()
    let uploads = j.items[0].contentDetails.relatedPlaylists.uploads
    let vr = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploads}&maxResults=5&key=${apiKey}`)
    let vj = await vr.json()
    for (let item of vj.items) {
        let vid = item.snippet.resourceId.videoId
        let dr = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${vid}&key=${apiKey}`)
        let dj = await dr.json()
        if (dj.items[0].liveStreamingDetails && dj.items[0].liveStreamingDetails.activeLiveChatId) {
            return vid
        }
    }
    return null
}

async function getChatId(videoId) {
    let r = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${videoId}&key=${apiKey}`)
    let j = await r.json()
    return j.items[0].liveStreamingDetails.activeLiveChatId || null
}

async function loadMessages() {
    if (!chatId) return
    let r = await fetch(`https://www.googleapis.com/youtube/v3/liveChat/messages?liveChatId=${chatId}&part=snippet,authorDetails&pageToken=${nextPage}&key=${apiKey}`)
    let j = await r.json()
    nextPage = j.nextPageToken || ""
    j.items.forEach(m => {
        let div = document.createElement("div")
        div.className = "message"
        div.innerHTML = `<span class="name">${m.authorDetails.displayName}</span>: ${m.snippet.displayMessage}`
        container.appendChild(div)
        container.scrollTop = container.scrollHeight
    })
}

document.addEventListener("keydown", async e => {
    if (e.code === "Space") {
        e.preventDefault()
        if (interval) clearInterval(interval)
        container.innerHTML = ""
        container.style.display = "block"
        let input = prompt("Enter channel (@handle, URL, or channel ID)")
        if (!input) return
        let channelId = await getChannelId(input)
        if (!channelId) {
            container.textContent = "Channel not found"
            return
        }
        let videoId = await getLiveVideo(channelId)
        if (!videoId) {
            container.textContent = "No active livestream"
            return
        }
        chatId = await getChatId(videoId)
        if (!chatId) {
            container.textContent = "Live chat unavailable"
            return
        }
        loadMessages()
        interval = setInterval(loadMessages, 3000)
    }
})
</script>

</body>
</html>
