<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Live Chat Overlay</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

#chatBox {
    position: absolute;
    right: 0;
    bottom: 0;
    width: 350px;
    height: 600px;
    padding: 20px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    overflow: hidden;
}

.message {
    color: white;
    font-size: 18px;
    margin-top: 10px;
    word-wrap: break-word;
    white-space: normal;
}

.name {
    font-weight: bold;
    color: #00ffcc;
}
</style>
</head>
<body>

<div id="chatBox"></div>

<script>
let apiKey = "AIzaSyArsE7xFU4H3Yln1z13DXLby2ASWT8TFuo"
let channelId = "UCIa777ItGO0vXFPcCpkwzng"

let chatBox = document.getElementById("chatBox")
let chatId = null
let nextPage = ""
let polling = false
let pollTime = 3000

async function getLiveVideo() {
    let r = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&channelId=${channelId}&eventType=live&type=video&key=${apiKey}`)
    let j = await r.json()
    if (j.items && j.items.length) return j.items[0].id.videoId
    return null
}

async function getChatId(videoId) {
    let r = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=liveStreamingDetails&id=${videoId}&key=${apiKey}`)
    let j = await r.json()
    return j.items[0].liveStreamingDetails.activeLiveChatId || null
}

async function pollChat() {
    if (!polling || !chatId) return
    let r = await fetch(`https://www.googleapis.com/youtube/v3/liveChat/messages?liveChatId=${chatId}&part=snippet,authorDetails&pageToken=${nextPage}&key=${apiKey}`)
    let j = await r.json()
    pollTime = j.pollingIntervalMillis || pollTime
    nextPage = j.nextPageToken || nextPage
    j.items.forEach(m => {
        let div = document.createElement("div")
        div.className = "message"
        div.innerHTML = `<span class="name">${m.authorDetails.displayName}</span>: ${m.snippet.displayMessage}`
        chatBox.appendChild(div)
    })
    setTimeout(pollChat, pollTime)
}

async function start() {
    let videoId = await getLiveVideo()
    if (!videoId) return
    chatId = await getChatId(videoId)
    if (!chatId) return
    polling = true
    pollChat()
}

start()
</script>

</body>
</html>
